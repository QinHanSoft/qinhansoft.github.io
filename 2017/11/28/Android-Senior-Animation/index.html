<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Android高级进阶笔记-动画机制 | 长桥の情书</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Android高级进阶笔记-动画机制</h1><a id="logo" href="/.">长桥の情书</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Android高级进阶笔记-动画机制</h1><div class="post-meta">Nov 28, 2017</div><a data-disqus-identifier="2017/11/28/Android-Senior-Animation/" href="/2017/11/28/Android-Senior-Animation/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>熟练掌握Android动画机制并实现出符合设计师要求的动画效果，是一名中高级Android应用开发者的基本功。在Android 3.0之前的版本，我们能使用的动画类型有两种，分别是帧动画和补间动画；在Android 3.0发布时，Android SDK又为开发者代理了更加强大灵活的属性动画，是的实现复杂的动画效果更加容易；在Android 4.4中，Android SDK又带来了android.transition框架，这使得开发者可以通过一种更直观的方式定义动画，下面分别介绍这四种动画类型。</p>
<h3 id="1-帧动画"><a href="#1-帧动画" class="headerlink" title="1. 帧动画"></a>1. 帧动画</h3><p>帧动画也叫Drawable Animation，是最简单最直观的动画类型，它利用人眼的视觉残留效应。在Android中实现帧动画，就是由设计师给出一系列状态不断变化的图片，开发者可以指定动画中每一帧对应的图片和持续的时间，然后就可以播放动画了。有两种方式可以定义帧动画，分别是XML资源文件和代码实现。</p>
<h4 id="1-1-XML资源文件定义帧动画"><a href="#1-1-XML资源文件定义帧动画" class="headerlink" title="1.1 XML资源文件定义帧动画"></a>1.1 XML资源文件定义帧动画</h4><p>这是最常用的方式，首先将每一帧的图片放到res/drawable目录中，然后在res/drawable目录中创建一个动画XML文件，在这个文件中使用<animation-list>标签定义动画帧序列，使用<item>标签定义动画的每一帧，并在其中指定帧的持续时间等属性，格式如下：</item></animation-list></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">animation-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:oneshot</span>=<span class="string">"false"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span></span></div><div class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/shape_loading_01"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"100"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span></span></div><div class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/shape_loading_02"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"100"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span></span></div><div class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/shape_loading_03"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"100"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span></span></div><div class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/shape_loading_04"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"100"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span></span></div><div class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/shape_loading_05"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"100"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">animation-list</span>&gt;</span></div></pre></td></tr></table></figure>
<p>其中android:oneshot用来控制动画是否循环播放，如果取值为true，表示动画不会循环播放，否则动画循环播放；android:duration指定动画每一帧的播放持续时间。</p>
<h4 id="1-2-代码定义帧动画"><a href="#1-2-代码定义帧动画" class="headerlink" title="1.2 代码定义帧动画"></a>1.2 代码定义帧动画</h4><p>代码中定义帧动画也很简单，但不常用，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">AnimationDrawable animationDrawable = <span class="keyword">new</span> AnimationDrawable();</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</div><div class="line">    <span class="keyword">int</span> id = getResources().getIdentifier(<span class="string">"shape_loading_0"</span> + i, <span class="string">"drawable"</span>, getPackageName());</div><div class="line">    Drawable drawable = getResources().getDrawable(id);</div><div class="line">    animationDrawable.addFrame(drawable, <span class="number">100</span>);</div><div class="line">&#125;</div><div class="line">imageAnimation.setBackground(animationDrawable);</div><div class="line">animationDrawable.setOneShot(<span class="keyword">false</span>);</div></pre></td></tr></table></figure>
<p>定义好帧动画后，可以在符合某个条件时触发或者停止动画播放。</p>
<h3 id="2-补间动画（Tween-Animation）"><a href="#2-补间动画（Tween-Animation）" class="headerlink" title="2. 补间动画（Tween Animation）"></a>2. 补间动画（Tween Animation）</h3><p>补间动画是指开发者无须定义动画过程中的每一帧，只需要定义动画的开始和结束这两个关键帧，并指定动画变化的时间和方式等，然后交给Android系统进行计算，通过在两个关键帧之间插入渐变值来实现平滑过渡，从而对View的内容完成一系列的图形变换来实现的动画效果，主要包括四种基本效果：透明度变化Alpha、大小大小变化Scale、位移变化Translate和旋转变化Rotate，四种效果可以组合，从而实现复杂灵活的动画。同样，定义补间动画也可以分为XML资源文件和代码两种方式。首先，要先了解一下插值器Interpolator。</p>
<h4 id="2-1-插值器Interpolator"><a href="#2-1-插值器Interpolator" class="headerlink" title="2.1 插值器Interpolator"></a>2.1 插值器Interpolator</h4><p>Android系统会在补间动画的开始和结束关键帧之间插入渐变值，它依据的便是Interpolator。具体说，Interpolator会根据类型的不同，选择不同的计算方法计算出在补间动画期间所需要动态插入帧的密度和位置，Interpolator负责控制动画的变化速度，使得前面所说的四种基本动画效果能够以匀速、加速、减速、抛物线等多种速度进行变化。</p>
<p>具体到代码中，Interpolator类其实是一个空接口，它继承自TimeInterpolator，TimeInterpolator时间插值器允许动画进行非线性运动变换，如加速、减速等，这个接口中只有一个<code>float getInterpolation(float input)</code>方法。入参是0.0~1.0的值，返回值可以小于0.0，也可以大于1.0，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Interpolator</span> <span class="keyword">extends</span> <span class="title">TimeInterpolator</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TimeInterpolator</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">float</span> <span class="title">getInterpolation</span><span class="params">(<span class="keyword">float</span> input)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Android SDK提供了几个Interpolator的实现类，如下表所示：</p>
<table>
<thead>
<tr>
<th style="text-align:left">插值器类型&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
<th style="text-align:left">功能说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">AccelerateDecelerateInterpolator</td>
<td style="text-align:left">在动画开始与结束的时候速率改变比较慢，在中间的时候加速</td>
</tr>
<tr>
<td style="text-align:left">AccelerateInterpolator</td>
<td style="text-align:left">在动画开始的地方速率改变比较慢，然后开始加速</td>
</tr>
<tr>
<td style="text-align:left">AnticipateInterpolator</td>
<td style="text-align:left">动画开始的时候先向后，然后向前滑动</td>
</tr>
<tr>
<td style="text-align:left">AnticipateOvershootInterpolator</td>
<td style="text-align:left">动画开始时先向后，然后向前甩一定值后返回最后的值</td>
</tr>
<tr>
<td style="text-align:left">BounceInterpolator</td>
<td style="text-align:left">动画结束的时候弹起</td>
</tr>
<tr>
<td style="text-align:left">CycleInterpolator</td>
<td style="text-align:left">动画循环播放特定的次数，速率的改变遵循正弦曲线</td>
</tr>
<tr>
<td style="text-align:left">DecelerateInterpolator</td>
<td style="text-align:left">动画在开始时速率变化较快，然后开始减速</td>
</tr>
<tr>
<td style="text-align:left">LinearInterpolator</td>
<td style="text-align:left">动画以常量速率改变</td>
</tr>
<tr>
<td style="text-align:left">OvershootInterpolator</td>
<td style="text-align:left">动画向前甩一定值后再回到原来位置</td>
</tr>
<tr>
<td style="text-align:left">PathInterpolator</td>
<td style="text-align:left">新增插值器，通过定义路径坐标，动画可以按照路径坐标来运行；注意这里的坐标并不是指十字坐标系，而是单方向，也就是可以从0~1，然后弹回0.6后再弹回到0.8，直到最后时间结束</td>
</tr>
</tbody>
</table>
<p>如果上述默认的插值器都不符合我们的实际需求，开发者也可以通过实现Interpolator接口来变形自己的插值器。</p>
<p>Android SDK使用Animation类来表示抽象的动画类，上面介绍的补间动画四种基本类型分别对应下表中的几个类：</p>
<table>
<thead>
<tr>
<th style="text-align:left">动画类型&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
<th style="text-align:left">功能说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">AlphaAnimation</td>
<td style="text-align:left">改变透明度的动画，创建动画时需要指定动画开始和结束时的透明度，以及动画持续时间，透明度取值范围是[0,1]</td>
</tr>
<tr>
<td style="text-align:left">ScaleAnimation</td>
<td style="text-align:left">大小缩放动画，创建动画时需要指定动画开始和结束时在X轴和Y轴的缩放比，以及动画持续时间；同时由于缩放时以不同的点作为中心会产生不同的效果，因此也需要通过pivotX和pivotY指定缩放中心的坐标</td>
</tr>
<tr>
<td style="text-align:left">TranslateAnimation</td>
<td style="text-align:left">位移动画，创建动画时需要指定开始和结束时的X、Y坐标，以及动画的持续时间</td>
</tr>
<tr>
<td style="text-align:left">RotateAnimation</td>
<td style="text-align:left">旋转动画，创建动画时需要指定开始和结束时的旋转角度，以及动画持续时间；同时由于旋转时以不同的点作为中心会产生不同的效果，因此也需要通过pivotX和pivotY指定旋转中心的坐标</td>
</tr>
</tbody>
</table>
<h4 id="2-2-AlphaAnimation"><a href="#2-2-AlphaAnimation" class="headerlink" title="2.2 AlphaAnimation"></a>2.2 AlphaAnimation</h4><p>XML方式就是在res/anim目录中新建XML文件，其中的内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:duration</span>=<span class="string">"2000"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:interpolator</span>=<span class="string">"@android:anim/accelerate_decelerate_interpolator"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 1.0表示完全不透明，0.0表示完全透明 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">alpha</span></span></div><div class="line"><span class="tag">        <span class="attr">android:fromAlpha</span>=<span class="string">"0.0"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:toAlpha</span>=<span class="string">"1.0"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Animation animation = AnimationUtils.loadAnimation(<span class="keyword">this</span>, R.anim.animation_alpha);</div><div class="line">view.setAnimation(animation);</div></pre></td></tr></table></figure>
<p>AlphaAnimation的构造方法只有两个参数，分别是初始的透明度和结束的透明度，语句如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">AlphaAnimation</span><span class="params">(<span class="keyword">float</span> fromAlpha, <span class="keyword">float</span> toAlpha)</span> </span>&#123;</div><div class="line">    mFromAlpha = fromAlpha;</div><div class="line">    mToAlpha = toAlpha;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在代码中实现Alpha动画也很简单，只要创建一个AlphaAnimation实例，然后设置动画持续时间即可，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">AlphaAnimation animation = <span class="keyword">new</span> AlphaAnimation(<span class="number">0</span>, <span class="number">1</span>); <span class="comment">// 透明度从0变化到1</span></div><div class="line">animation.setDuration(<span class="number">2000</span>); <span class="comment">// 持续时间2000毫秒</span></div><div class="line">animation.setFillAfter(<span class="keyword">true</span>); <span class="comment">// 动画结束后保留结束状态</span></div><div class="line">view.setAnimation(animation);</div></pre></td></tr></table></figure>
<h4 id="2-3-ScaleAnimation"><a href="#2-3-ScaleAnimation" class="headerlink" title="2.3 ScaleAnimation"></a>2.3 ScaleAnimation</h4><p>XML实现如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:interpolator</span>=<span class="string">"@android:anim/accelerate_decelerate_interpolator"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:duration</span>=<span class="string">"2000"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">scale</span></span></div><div class="line"><span class="tag">        <span class="attr">android:fromXScale</span>=<span class="string">"0.2"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:fromYScale</span>=<span class="string">"0.2"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:pivotX</span>=<span class="string">"50%"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:pivotY</span>=<span class="string">"50%"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:toXScale</span>=<span class="string">"1.5"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:toYScale</span>=<span class="string">"1.5"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在代码实现中，ScaleAnimation可用的构造有三个，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">ScaleAnimation</span><span class="params">(<span class="keyword">float</span> fromX, <span class="keyword">float</span> toX, <span class="keyword">float</span> fromY, <span class="keyword">float</span> toY)</span> </span>&#123;</div><div class="line">    mResources = <span class="keyword">null</span>;</div><div class="line">    mFromX = fromX;</div><div class="line">    mToX = toX;</div><div class="line">    mFromY = fromY;</div><div class="line">    mToY = toY;</div><div class="line">    mPivotX = <span class="number">0</span>;</div><div class="line">    mPivotY = <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">ScaleAnimation</span><span class="params">(<span class="keyword">float</span> fromX, <span class="keyword">float</span> toX, <span class="keyword">float</span> fromY, <span class="keyword">float</span> toY,</span></span></div><div class="line"><span class="function"><span class="params">        <span class="keyword">float</span> pivotX, <span class="keyword">float</span> pivotY)</span> </span>&#123;</div><div class="line">    mResources = <span class="keyword">null</span>;</div><div class="line">    mFromX = fromX;</div><div class="line">    mToX = toX;</div><div class="line">    mFromY = fromY;</div><div class="line">    mToY = toY;</div><div class="line"></div><div class="line">    mPivotXType = ABSOLUTE;</div><div class="line">    mPivotYType = ABSOLUTE;</div><div class="line">    mPivotXValue = pivotX;</div><div class="line">    mPivotYValue = pivotY;</div><div class="line">    initializePivotPoint();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">ScaleAnimation</span><span class="params">(<span class="keyword">float</span> fromX, <span class="keyword">float</span> toX, <span class="keyword">float</span> fromY, <span class="keyword">float</span> toY,</span></span></div><div class="line"><span class="function"><span class="params">        <span class="keyword">int</span> pivotXType, <span class="keyword">float</span> pivotXValue, <span class="keyword">int</span> pivotYType, <span class="keyword">float</span> pivotYValue)</span> </span>&#123;</div><div class="line">    mResources = <span class="keyword">null</span>;</div><div class="line">    mFromX = fromX;</div><div class="line">    mToX = toX;</div><div class="line">    mFromY = fromY;</div><div class="line">    mToY = toY;</div><div class="line"></div><div class="line">    mPivotXValue = pivotXValue;</div><div class="line">    mPivotXType = pivotXType;</div><div class="line">    mPivotYValue = pivotYValue;</div><div class="line">    mPivotYType = pivotYValue;</div><div class="line">    initializePivotPoint();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> voud <span class="title">initializePivotPoint</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mPivotXType == ABSOLUTE) &#123;</div><div class="line">        mPivotX = mPivotXValue;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (mPivotYType == ABSOLUTE) &#123;</div><div class="line">        mPivotY = mPivotYValue;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到，涉及的参数比较多，具体含义如下表所示：</p>
<table>
<thead>
<tr>
<th style="text-align:left">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;参&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
<th style="text-align:left">含义说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">fromX</td>
<td style="text-align:left">动画开始是X坐标的伸缩尺寸</td>
</tr>
<tr>
<td style="text-align:left">toX</td>
<td style="text-align:left">动画结束时X坐标的伸缩尺寸</td>
</tr>
<tr>
<td style="text-align:left">fromY</td>
<td style="text-align:left">动画开始时Y坐标的伸缩尺寸</td>
</tr>
<tr>
<td style="text-align:left">toY</td>
<td style="text-align:left">动画结束时Y坐标的伸缩尺寸</td>
</tr>
<tr>
<td style="text-align:left">pivotX/pivotXValue</td>
<td style="text-align:left">缩放动画中心点X坐标</td>
</tr>
<tr>
<td style="text-align:left">pivotY/pivotYValue</td>
<td style="text-align:left">缩放动画中心点Y坐标</td>
</tr>
<tr>
<td style="text-align:left">pivotXType</td>
<td style="text-align:left">动画在X轴的伸缩模式，也就是中心点相对于谁，取值是Animation.ABSOLUTE、Animation.RELATIVE_TO_SELF或Animation.RELATIVE_TO_PARENT</td>
</tr>
<tr>
<td style="text-align:left">pivotYType</td>
<td style="text-align:left">动画在Y轴的伸缩模式，也就是中心点相对于谁，取值是Animation.ABSOLUTE、Animation.RELATIVE_TO_SELF或Animation.RELATIVE_TO_PARENT</td>
</tr>
</tbody>
</table>
<p>ScaleAnimation具体使用代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> ScaleAnimation animation = <span class="keyword">new</span> ScaleAnimation(<span class="number">0.2f</span>, <span class="number">1.5f</span>, <span class="number">0.2f</span>, <span class="number">1.5f</span>,</div><div class="line">            Animation.RELATIVE_TO_SELF, <span class="number">0.0f</span>,</div><div class="line">            Animation.RELATIVE_TO_SELF, <span class="number">0.0f</span>);</div><div class="line">animation.setDuration(<span class="number">2000</span>);</div><div class="line">animation.setFillAfter(<span class="keyword">true</span>);</div><div class="line">view.setAnimation(animation);</div></pre></td></tr></table></figure>
<h4 id="2-4-TranslateAnimation"><a href="#2-4-TranslateAnimation" class="headerlink" title="2.4 TranslateAnimation"></a>2.4 TranslateAnimation</h4><p>XML实现如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:duration</span>=<span class="string">"2000"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:interpolator</span>=<span class="string">"@android:anim/accelerate_decelerate_interpolator"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">translate</span></span></div><div class="line"><span class="tag">        <span class="attr">android:fromXDelta</span>=<span class="string">"0"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:fromYDelta</span>=<span class="string">"0"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:toXDelta</span>=<span class="string">"0"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:toYDelta</span>=<span class="string">"1000"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在代码实现中，TranslateAnimation可用的构造有两个，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">TranslateAnimation</span><span class="params">(<span class="keyword">float</span> fromXDelta, <span class="keyword">float</span> toXDelta, <span class="keyword">float</span> fromYDelte, <span class="keyword">float</span> toYDelta)</span> </span>&#123;</div><div class="line">    mFromXValue = fromXDelta;</div><div class="line">    mToXValue = toXDelta;</div><div class="line">    mFromYValue = fromYDelte;</div><div class="line">    mToYValue = toYDelta;</div><div class="line"></div><div class="line">    mFromXType = ABSOLUTE;</div><div class="line">    mToXType = ABSOLUTE;</div><div class="line">    mFromYType = ABSOLUTE;</div><div class="line">    mToYType = ABSOLUTE;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">TranslateAnimation</span><span class="params">(<span class="keyword">int</span> formXType, <span class="keyword">float</span> fromXValue, <span class="keyword">int</span> toXType, <span class="keyword">float</span> toXValue,</span></span></div><div class="line"><span class="function"><span class="params">        <span class="keyword">int</span> fromYType, <span class="keyword">float</span> fromYValue, <span class="keyword">int</span> toYType, <span class="keyword">float</span> toYValue)</span> </span>&#123;</div><div class="line">    mFromXValue = fromXValue;</div><div class="line">    mToXValue = toXValue;</div><div class="line">    mFromYValue = fromYValue;</div><div class="line">    mToYValue = toYValue;</div><div class="line"></div><div class="line">    mFromXType = formXType;</div><div class="line">    mToXType = toXType;</div><div class="line">    mFromYType = fromYType;</div><div class="line">    mToYType = toYType;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中，入参的含义如下表所示：</p>
<table>
<thead>
<tr>
<th style="text-align:left">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;参&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
<th style="text-align:left">含义说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">fromXType</td>
<td style="text-align:left">动画开始时在X轴的位移模式，取值是Animation.ABSOLUTE、Animation.RELATIVE_TO_SELF或Animation.RELATIVE_TO_PARENT</td>
</tr>
<tr>
<td style="text-align:left">fromXValue/fromXDelta</td>
<td style="text-align:left">动画开始时当前View的X坐标</td>
</tr>
<tr>
<td style="text-align:left">toXType</td>
<td style="text-align:left">动画结束时在X轴的位移模式，取值是Animation.ABSOLUTE、Animation.RELATIVE_TO_SELF或Animation.RELATIVE_TO_PARENT</td>
</tr>
<tr>
<td style="text-align:left">toXValue/toXDelta</td>
<td style="text-align:left">动画结束时当前View的X坐标</td>
</tr>
<tr>
<td style="text-align:left">fromYType</td>
<td style="text-align:left">动画开始时在Y轴的位移模式，取值是Animation.ABSOLUTE、Animation.RELATIVE_TO_SELF或Animation.RELATIVE_TO_PARENT</td>
</tr>
<tr>
<td style="text-align:left">fromYValue/fromYDelte</td>
<td style="text-align:left">动画开始时当前View的Y坐标</td>
</tr>
<tr>
<td style="text-align:left">toYType</td>
<td style="text-align:left">动画结束时在Y轴的位移模式，取值是Animation.ABSOLUTE、Animation.RELATIVE_TO_SELF或Animation.RELATIVE_TO_PARENT</td>
</tr>
<tr>
<td style="text-align:left">toYValue/toYDelta</td>
<td style="text-align:left">冻灾结束时当前View的Y坐标</td>
</tr>
</tbody>
</table>
<p>TranslateAnimation的使用如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">TranslateAnimation animation = <span class="keyword">new</span> TranslateAnimation(Animation.RELATIVE_TO_SELF, <span class="number">0</span>,</div><div class="line">        Animation.RELATIVE_TO_SELF, <span class="number">2f</span>,</div><div class="line">        Animation.RELATIVE_TO_SELF, <span class="number">0f</span>,</div><div class="line">        Animation.RELATIVE_TO_SELF, <span class="number">2f</span>);</div><div class="line">animation.setDuration(<span class="number">2000</span>);</div><div class="line">animation.setFillAfter(<span class="keyword">true</span>);</div><div class="line">view.setAnimation(animation);</div></pre></td></tr></table></figure>
<h4 id="2-5-RotateAnimation"><a href="#2-5-RotateAnimation" class="headerlink" title="2.5 RotateAnimation"></a>2.5 RotateAnimation</h4><p>XML实现如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:duration</span>=<span class="string">"2000"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:interpolator</span>=<span class="string">"@android:anim/accelerate_decelerate_interpolator"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">rotate</span></span></div><div class="line"><span class="tag">        <span class="attr">android:fromDegrees</span>=<span class="string">"0"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:pivotX</span>=<span class="string">"50%"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:pivotY</span>=<span class="string">"50%"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:startOffset</span>=<span class="string">"0"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:repeatCount</span>=<span class="string">"-1"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:repeatMode</span>=<span class="string">"restart"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:toDegrees</span>=<span class="string">"360"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在代码实现中，RotateAnimation可用的构造有三个，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">RotateAnimation</span><span class="params">(<span class="keyword">float</span> fromDegrees, <span class="keyword">float</span> toDegrees)</span> </span>&#123;</div><div class="line">    mFromDegrees = fromDegrees;</div><div class="line">    mToDegrees = toDegrees;</div><div class="line">    mPivotX = <span class="number">0.0f</span>;</div><div class="line">    mPivotY = <span class="number">0.0f</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">RotateAnimation</span><span class="params">(<span class="keyword">float</span> fromDegrees, <span class="keyword">float</span> toDegrees, <span class="keyword">float</span> pivotX, <span class="keyword">float</span> pivotY)</span> </span>&#123;</div><div class="line">    mFromDegrees = fromDegrees;</div><div class="line">    mToDegrees = toDegrees;</div><div class="line"></div><div class="line">    mPivotXType = ABSOLUTE;</div><div class="line">    mPivotYType = ABSOLUTE;</div><div class="line">    mPivotXValue = pivotX;</div><div class="line">    mPivotYValue = pivotY;</div><div class="line">    initializePivotPoint();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">RotateAnimation</span><span class="params">(<span class="keyword">float</span> fromDegrees, <span class="keyword">float</span> toDegrees, <span class="keyword">int</span> pivotXType, <span class="keyword">float</span> pivotXValue,</span></span></div><div class="line"><span class="function"><span class="params">        <span class="keyword">int</span> pivotYType, <span class="keyword">float</span> pivotYValue)</span> </span>&#123;</div><div class="line">    mFromDegrees = fromDegrees;</div><div class="line">    mToDegrees = toDegrees;</div><div class="line"></div><div class="line">    mPivotXValue = pivotXValue;</div><div class="line">    mPivotXType = pivotXType;</div><div class="line">    mPivotYValue = pivotYValue;</div><div class="line">    mPivotYType = pivotYType;</div><div class="line">    initializePivotPoint();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initializePivotPoint</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mPivotXType == ABSOLUTE) &#123;</div><div class="line">        mPivotX = mPivotXValue;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (mPivotYType = ABSOLUTE) &#123;</div><div class="line">        mPivotY = mPivotYValue;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中，入参的含义如下表所示：</p>
<table>
<thead>
<tr>
<th style="text-align:left">&nbsp;&nbsp;&nbsp;&nbsp;参&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数&nbsp;&nbsp;&nbsp;&nbsp;</th>
<th style="text-align:left">含义说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">fromDegrees</td>
<td style="text-align:left">动画开始时的旋转角度</td>
</tr>
<tr>
<td style="text-align:left">toDegrees</td>
<td style="text-align:left">动画结束时的旋转角度</td>
</tr>
<tr>
<td style="text-align:left">pivotXType</td>
<td style="text-align:left">动画在X轴的旋转模式，即相对位置类型，取值是Animation.ABSOLUTE、Animation.RELATIVE_TO_SELF或Animation.RELATIVE_TO_PARENT</td>
</tr>
<tr>
<td style="text-align:left">pivotXValue</td>
<td style="text-align:left">动画相对X坐标开始位置</td>
</tr>
<tr>
<td style="text-align:left">pivotYType</td>
<td style="text-align:left">动画在Y轴的旋转模式，即相对位置类型，取值是Animation.ABSOLUTE、Animation.RELATIVE_TO_SELF或Animation.RELATIVE_TO_PARENT</td>
</tr>
<tr>
<td style="text-align:left">pivotYValue</td>
<td style="text-align:left">动画相对Y坐标开始位置</td>
</tr>
</tbody>
</table>
<p>RotateAnimation使用如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">RotateAnimation animation = <span class="keyword">new</span> RotateAnimation(<span class="number">0</span>, -<span class="number">720</span>,</div><div class="line">        Animation.RELATIVE_TO_SELF, <span class="number">0.5f</span>,</div><div class="line">        Animation.RELATIVE_TO_SELF, <span class="number">0.5f</span>);</div><div class="line">animation.setDuration(<span class="number">2000</span>);</div><div class="line">animation.setFillAfter(<span class="keyword">true</span>);</div><div class="line">view.setAnimation(animation);</div></pre></td></tr></table></figure>
<h4 id="2-6-自定义补间动画"><a href="#2-6-自定义补间动画" class="headerlink" title="2.6 自定义补间动画"></a>2.6 自定义补间动画</h4><p>在实际项目中，我们会遇到使用上述四种基本动画无法实现的动画需求，这是可以考虑自定义补间动画，只需要继承Animation，并重写这个抽象基类中的applyTransformation()方法，在其中实现具体的动画变换逻辑，语句代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnimation</span> <span class="keyword">extends</span> <span class="title">Animation</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">applyTransformation</span><span class="params">(<span class="keyword">float</span> interpolatedTime, Transformation transformation)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.applyTransformation(interpolatedTime, transformation);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中，interpolatedTime表示动画的时间进行比，无论动画的实际持续时间是多久，这个参数总会是从0变化到1。transformation表示补间动画在不同时刻对View的变化程度。</p>
<h3 id="3-属性动画（Property-Animation）"><a href="#3-属性动画（Property-Animation）" class="headerlink" title="3. 属性动画（Property Animation）"></a>3. 属性动画（Property Animation）</h3><p>属性动画是在Android 3.0 中引入的，在补间动画中我们只能改变View的绘制效果，View的真实属性是没有变化的，而属性动画则可以直接改变View对象的属性值，同时属性动画几乎可以对任何对象执行动画，而不是局限在View对象上，从某种意义上讲，属性动画可以说的增强版的补间动画。与补间动画类似，属性动画也涉及到下表中的基本属性：</p>
<table>
<thead>
<tr>
<th style="text-align:left">&nbsp;&nbsp;&nbsp;&nbsp;动画属性&nbsp;&nbsp;&nbsp;&nbsp;</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">动画持续时间</td>
<td style="text-align:left">默认值是300毫秒，在资源文件中通过android:duration指定</td>
</tr>
<tr>
<td style="text-align:left">动画插值方式</td>
<td style="text-align:left">详见补间动画介绍，在资源文件中通过android:interpolator指定</td>
</tr>
<tr>
<td style="text-align:left">动画重复次数</td>
<td style="text-align:left">指定动画重复播放的次数，在资源文件中通过android:repeatCount指定</td>
</tr>
<tr>
<td style="text-align:left">动画重复模式</td>
<td style="text-align:left">指定一次动画播放结束后，重复下次动画时，是从开始帧再次播放到结束帧，还是从结束帧反方向播放到开始帧，在资源文件中通过android:repeatMode指定</td>
</tr>
<tr>
<td style="text-align:left">帧刷新频率</td>
<td style="text-align:left">指定间隔多长时间播放一帧，默认值是10毫秒</td>
</tr>
<tr>
<td style="text-align:left">动画集合</td>
<td style="text-align:left">通过动画集合可以将多个动画组合起来，同时通过指定android:ordering属性可以控制这组动画是按次序播放还是同时播放，在资源文件中通过<set>…</set>来表示</td>
</tr>
</tbody>
</table>
<p>属性动画的基类是Animator，它是一个抽象类，所以不会直接使用这个类，通常都是继承它并重写其中的相关方法，Android SDK 提供了几个子类，大多数情况下使用这些子类就足够满足需求了。</p>
<h4 id="3-1-Evaluator"><a href="#3-1-Evaluator" class="headerlink" title="3.1 Evaluator"></a>3.1 Evaluator</h4><p>首先来了解Evaluator的概念，它是用来控制属性动画如何计算属性值的。接口定义是TypeEvaluator，其中定义了evaluate()方法，共不同类型的子类实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TypeEvaluator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">evaluate</span><span class="params">(<span class="keyword">float</span> fraction, T startValue, T endValue)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>常见的实现类有IntEvaluator、FloatEvaluator、ArgbEvaluator等。下面看一下ArgbEvaluator的具体实现，可以看到实现逻辑很简单，就是根据输入的初始值和结束值以及一个进度比，计算出每一个进度对应的ARGB值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArgbEvaluator</span> <span class="keyword">implements</span> <span class="title">TypeEvaluator</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ArgbEvaluator sInstance = <span class="keyword">new</span> ArgbEvaluator();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ArgbEvaluator <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> sInstance;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">evaluate</span><span class="params">(folat fraction, Object startValue, Object endValue)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> startInt = (Integer) startValue;</div><div class="line">        <span class="keyword">float</span> startA = ((startInt &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>) / <span class="number">255.0f</span>;</div><div class="line">        <span class="keyword">float</span> startR = ((startInt &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>) / <span class="number">255.0f</span>;</div><div class="line">        <span class="keyword">float</span> startG = ((startInt &gt;&gt;  <span class="number">8</span>) &amp; <span class="number">0xff</span>) / <span class="number">255.0f</span>;</div><div class="line">        <span class="keyword">float</span> startB = ( startInt        &amp; <span class="number">0xff</span>) / <span class="number">255.0f</span>;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> endInt = (Integer) endValue;</div><div class="line">        <span class="keyword">float</span> endA = ((endInt &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>) / <span class="number">255.0f</span>;</div><div class="line">        <span class="keyword">float</span> endR = ((endInt &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>) / <span class="number">255.0f</span>;</div><div class="line">        <span class="keyword">float</span> endG = ((endInt &gt;&gt;  <span class="number">8</span>) &amp; <span class="number">0xff</span>) / <span class="number">255.0f</span>;</div><div class="line">        <span class="keyword">float</span> endB = ( endInt        &amp; <span class="number">0xff</span>) / <span class="number">255.0f</span>;</div><div class="line"></div><div class="line">        <span class="comment">// convert from sRGB to linear</span></div><div class="line">        startR = (<span class="keyword">float</span>) Math.pow(startR, <span class="number">2.2</span>);</div><div class="line">        startG = (<span class="keyword">float</span>) Math.pow(startG, <span class="number">2.2</span>);</div><div class="line">        startB = (<span class="keyword">float</span>) Math.pow(startB, <span class="number">2.2</span>);</div><div class="line"></div><div class="line">        endR = (<span class="keyword">float</span>) Math.pow(endR, <span class="number">2.2</span>);</div><div class="line">        endG = (<span class="keyword">float</span>) Math.pow(endG, <span class="number">2.2</span>);</div><div class="line">        endB = (<span class="keyword">float</span>) Math.pow(endB, <span class="number">2.2</span>);</div><div class="line"></div><div class="line">        <span class="comment">// compute teh interpolated color int linear space</span></div><div class="line">        <span class="keyword">float</span> a = startA + fraction * (endA - startA);</div><div class="line">        <span class="keyword">float</span> r = startR + fraction * (endR - startR);</div><div class="line">        <span class="keyword">float</span> g = startG + fraction * (endG - startG);</div><div class="line">        <span class="keyword">float</span> b = startB + fraction * (endB - startB);</div><div class="line"></div><div class="line">        <span class="comment">// convert back to sRGB in the [0..255] range</span></div><div class="line">        a = a * <span class="number">255.0f</span>;</div><div class="line">        r = (<span class="keyword">float</span>) Math.pow(r, <span class="number">1.0</span> / <span class="number">2.2</span>) * <span class="number">255.0f</span>;</div><div class="line">        g = (<span class="keyword">float</span>) Math.pow(g, <span class="number">1.0</span> / <span class="number">2.2</span>) * <span class="number">255.0f</span>;</div><div class="line">        b = (<span class="keyword">float</span>) Math.pow(b, <span class="number">1.0</span> / <span class="number">2.2</span>) * <span class="number">255.0f</span>;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> Math.round(a) &lt;&lt; <span class="number">24</span> | Math.round(r) &lt;&lt; <span class="number">16</span> | Math.round(g) &lt;&lt; <span class="number">8</span> | Math.round(b);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-2-AnimatorSet"><a href="#3-2-AnimatorSet" class="headerlink" title="3.2 AnimatorSet"></a>3.2 AnimatorSet</h4><p>AnimatorSet也是Animator的子类，用来组合多个Animator，并指定这些Animator是顺序播放还是同时播放。</p>
<h4 id="3-3-ValueAnimator"><a href="#3-3-ValueAnimator" class="headerlink" title="3.3 ValueAnimator"></a>3.3 ValueAnimator</h4><p>ValueAnimator是属性动画最重要的一个类，继承自Animator。它定义了属性动画大部分的核心功能，包括计算各个帧的属性值，处理更新事件、按照属性值的类型控制计算规则等。一个完整的属性动画由以下两部分组成：</p>
<ul>
<li>计算动画各个帧的相关属性值；</li>
<li>将这些属性值设置给指定的对象。</li>
</ul>
<p>ValueAnimator为开发者实现了第一部分的功能，第二部分功能由开发者自行设置。ValueAnimator的构造方法是空实现，一般都是使用如下的静态工厂方法来进行实例化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ValueAnimator <span class="title">ofInt</span><span class="params">(<span class="keyword">int</span>... values)</span> </span>&#123;</div><div class="line">    ValueAnimator anim = <span class="keyword">new</span> ValueAnimator();</div><div class="line">    anim.setIntValues(values);</div><div class="line">    <span class="keyword">return</span> anim;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ValueAnimator <span class="title">ofArgb</span><span class="params">(<span class="keyword">int</span>... values)</span> </span>&#123;</div><div class="line">    ValueAnimator anim = <span class="keyword">new</span> ValueAnimator();</div><div class="line">    anim.setIntValues(values);</div><div class="line">    anim.setEvaluator(ArgbEvaluator.getInstance());</div><div class="line">    <span class="keyword">return</span> anim;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ValueAnimator <span class="title">ofFloat</span><span class="params">(<span class="keyword">float</span>... values)</span> </span>&#123;</div><div class="line">    ValueAnimator anim = <span class="keyword">new</span> ValueAnimator();</div><div class="line">    anim.setFloat(values);</div><div class="line">    <span class="keyword">return</span> anim;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ValueAnimator <span class="title">ofPropertyValuesHolder</span><span class="params">(PropertyValuesHolder... values)</span> </span>&#123;</div><div class="line">    ValueAnimator anim = <span class="keyword">new</span> ValueAnimator();</div><div class="line">    anim.setValues(values);</div><div class="line">    <span class="keyword">return</span> anim;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ValueAnimator <span class="title">ofObject</span><span class="params">(TypeEvaluator evaluator, Object... values)</span> </span>&#123;</div><div class="line">    ValueAnimator anim = <span class="keyword">new</span> ValueAnimator();</div><div class="line">    anim.setObjectValues(values);</div><div class="line">    anim.setEvaluator(evaluator);</div><div class="line">    <span class="keyword">return</span> anim;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>获取到实例后，接着需要设置动画持续时间、插值方式、重复次数等属性值，然后启动动画，最后还需要为ValueAnimator注册AnimatorUpdateListener监听器，并在这个监听器的onAnimationUpdate()方法中将计算出来的属性值设置给指定对象。从React Native开源框架中可以看到如下用法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> curColor = activity.getWindow().getStatusBarColor();</div><div class="line">ValueAnimator colorAnimation = ValueAnimator.ofObject(</div><div class="line">    <span class="keyword">new</span> ArgbEvaluator(), curColor, color);</div><div class="line"></div><div class="line">colorAnimation.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animator)</span> </span>&#123;</div><div class="line">        activity.getWindow().setStatusBarColor((Integer) animator.getAnimatedValue());</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line">colorAnimation.setDuration(<span class="number">300</span>).setStartDelay(<span class="number">0</span>);</div><div class="line">colorAnimation.start();</div></pre></td></tr></table></figure>
<h4 id="3-4-ObjectAnimator"><a href="#3-4-ObjectAnimator" class="headerlink" title="3.4 ObjectAnimator"></a>3.4 ObjectAnimator</h4><p>ObjectAnimator是ValueAnimator的子类，封装实现了上面所说的第二部分功能。因此在实际开发中使用最多的就是ObjectAnimator，只有在ObjectAnimator实现不了的情况下才考虑使用ValueAnimator。ObjectAnimator和ValueAnimator在构造实例时最大的不同是需要指定动画作用的具体对象和对象的属性名，而且一般不需要注册AnimatorUpdateListener监听器，示例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomCircleProgressBar</span> <span class="keyword">extends</span> <span class="title">CircularProgressBar</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomCircleProgressBar</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProgressWithAnimation</span><span class="params">(<span class="keyword">float</span> progress, <span class="keyword">int</span> duration)</span> </span>&#123;</div><div class="line">        ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(<span class="keyword">this</span>, <span class="string">"progress"</span>, progress);</div><div class="line">        objectAnimator.setDuration(duration);</div><div class="line">        objectAnimator.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用ObjectAnimator有以下几点需要注意。</p>
<ul>
<li><p>需要为对象对应的属性提供setter方法。例如上面的progress属性在父类CircluarProgressBar提供了如下设置方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProgress</span><span class="params">(<span class="keyword">float</span> progress)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.progress = (progress &lt;= <span class="number">100</span>) ? progress : <span class="number">100</span>;</div><div class="line">    invalidate();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>如果动画的对象是View，那么为了能显示动画效果，在某些情况下，可能还需要指出AnimatorUpdateListener监听器，并在其回调方法onAnimationUpdate()中调用View的invalidate()方法来刷新View的显示。</p>
</li>
</ul>
<p>上面所说的都是在代码中定义属性动画。事实上，与补间动画类似，属性动画也可以在XML文件中定义，在工程的res/animator目录中存放的就是属性动画XML文件，示例如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:ordering</span>=<span class="string">"together"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></div><div class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"2000"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:propertyName</span>=<span class="string">"scaleX"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"1"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"0.4"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:valueType</span>=<span class="string">"floatType"</span> /&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></div><div class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"2000"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:propertyName</span>=<span class="string">"scaleY"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"1"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"0.4"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:valueType</span>=<span class="string">"floatType"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<p>使用代码加载如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadObjectAnimatorFromXml</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">    Animator animator = AnimatorInflater.loadAnimator(<span class="keyword">this</span>, R.animator.animator_scale);</div><div class="line">    animator.setTarget(view);</div><div class="line">    animator.start();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-过渡动画（Transition-Animation）"><a href="#4-过渡动画（Transition-Animation）" class="headerlink" title="4. 过渡动画（Transition Animation）"></a>4. 过渡动画（Transition Animation）</h3><p>过渡动画是在Android 4.4 引入的新的动画框架，它本质上还是属性动画，只不过对属性动画做了一层封装，方便开发者实现Activity或View的过渡动画效果。和属性动画相比，过渡动画最大的不同是需要为动画前后准备不同的布局，并通过对应的API实现两个布局的过渡动画，而属性动画只需要一个布局文件。</p>
<p>在使用Transition Animation框架实现动画效果之前，先来了解这个框架的几个基本概念。</p>
<ul>
<li><p>Scene：定义了页面的当前状态信息，Scene实例化一般通过静态工厂方法实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Scene <span class="title">getSceneForLayout</span><span class="params">(ViewGroup sceneRoot, <span class="keyword">int</span> layoutId, Context context)</span> </span>&#123;</div><div class="line">    SparseArray&lt;Scene&gt; scenes = (SparseArray&lt;Scene&gt;) sceneRoot.getTag(</div><div class="line">        com.android.internal.R.id.scene_layoutid_cache);</div><div class="line">    <span class="keyword">if</span> (scenes == <span class="keyword">null</span>) &#123;</div><div class="line">        scenes = <span class="keyword">new</span> SparseArray&lt;Scene&gt;();</div><div class="line">        sceneRoot.setTagInternal(com.android.internal.R.id.scene_layoutid_cache, scenes);</div><div class="line">    &#125;</div><div class="line">    Scene scene = scenes.get(layoutId);</div><div class="line">    <span class="keyword">if</span> (scene != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> scene;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        scene = <span class="keyword">new</span> Scene(sceneRoot, layoutId, context);</div><div class="line">        scenes.put(layoutId, scene);</div><div class="line">        <span class="keyword">return</span> scene;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Transition：定义了界面之间切换的动画信息，在使用TransitionManager时没有指定使用哪个Transition，那么会使用默认的AutoTransition，可以看出AutoTransition的动画效果就是先隐藏对象变透明，然后移动指定对象，最后显示出来，源码如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoTransition</span> <span class="keyword">extends</span> <span class="title">TransitionSet</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AutoTransition</span><span class="params">()</span> </span>&#123;</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AutoTransition</span><span class="params">(Context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        setOrdering(ORDERING_SEQUENTIAL);</div><div class="line">        addTransition(<span class="keyword">new</span> Fade(Fade.OUT)).</div><div class="line">                addTransition(<span class="keyword">new</span> ChangeBounds()).</div><div class="line">                addTransition(<span class="keyword">new</span> Fade(Fade.IN));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>TransitionManager：控制Scene之间切换的控制器，切换常用的方法有以下两个，其中的sDefaultTransition就是前面说的AutoTransition的实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">(Scene scene)</span> </span>&#123;</div><div class="line">    changeScene(scene, sDefaultTransition);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">(Scene scene, Transition transition)</span> </span>&#123;</div><div class="line">    changeScene(scene, transition);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>过渡动画的使用很简单，首先定义同一个页面的两种布局，分别是动画前和动画后的布局，我们将其命名为fragment_transition_scene_before.xml和fragment_transition_scene_after.xml，这两个布局文件的根布局有相同的android:id值，布局文件内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--fragment_transition_scene_before.xml--&gt;</span></div><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/scene"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/textView"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/app_name"</span> /&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/goButton"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_below</span>=<span class="string">"@id/textView"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/button_go"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--fragment_transition_scene_after.xml--&gt;</span></div><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/scene"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/textView"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/app_name"</span> /&gt;</span></div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/goButton"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"@string/button_go"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_below</span>=<span class="string">"@id/textView"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Transition Animation使用代码实现例子如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">goScene</span><span class="params">(Scene scene)</span> </span>&#123;</div><div class="line">    ChangeBounds changeBounds = <span class="keyword">new</span> ChangeBounds();</div><div class="line">    changeBounds.setDuration(<span class="number">2000</span>);</div><div class="line">    Fade fadeOut = <span class="keyword">new</span> Fade(Fade.OUT);</div><div class="line">    fadeOut.setDuration(<span class="number">2000</span>);</div><div class="line">    Fade fadeIn = <span class="keyword">new</span> Fade(Fade.IN);</div><div class="line">    fadeIn.setDuration(<span class="number">2000</span>);</div><div class="line">    TransitionSet transitionSet = <span class="keyword">new</span> TransitionSet();</div><div class="line">    transitionSet.setOrdering(TransitionSet.ORDERING_SEQUENTIAL);</div><div class="line">    transitionSet.addTransition(fadeOut)</div><div class="line">            .addTransition(changeBounds)</div><div class="line">            .addTransition(fadeIn);</div><div class="line">    TransitionManager.go(scene, transitionSet);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的代码分别演示了XML布局和代码实现两种方式，过渡动画的XML文件需要放在res/transition目录中，其中transition_manager.xml定义如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">transitionManager</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">transition</span></span></div><div class="line"><span class="tag">        <span class="attr">android:fromScene</span>=<span class="string">"@layout/fragment_transition_scene_before"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:toScene</span>=<span class="string">"@layout/fragment_transition_scene_after"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:transition</span>=<span class="string">"@transition/transition_slow_auto"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">transition</span></span></div><div class="line"><span class="tag">        <span class="attr">android:fromScene</span>=<span class="string">"@layout/fragment_transition_scene_before"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:toScene</span>=<span class="string">"@layout/fragment_transition_scene_after"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:transition</span>=<span class="string">"@transition/transition_slow_auto"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">transitionManager</span>&gt;</span></div></pre></td></tr></table></figure>
<p>其中transition_slow_auto也是定义在res/transition目录中的自定义Transition动画文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">transitionSet</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:transitionOrdering</span>=<span class="string">"sequential"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">fade</span></span></div><div class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"1000"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:fadingMode</span>=<span class="string">"fade_out"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">changeBounds</span></span></div><div class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"2000"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:interpolator</span>=<span class="string">"@android:interpolator/anticipate_overshoot"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">fade</span></span></div><div class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"1000"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:fadingMode</span>=<span class="string">"fade_in"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">transitionSet</span>&gt;</span></div></pre></td></tr></table></figure>
<style type="text/css">
    p {
        text-indent: 2em; /*首行缩进*/
    }

    table td: nth-child(1) {
        white-space: nowrap;
    }
    table th {
        white-space: nowrap;
    }
</style>
</div><div class="tags"></div><div class="post-nav"><a href="/2017/11/29/Android-Senior-Code-Optimize/" class="pre">Android高级进阶笔记-代码优化</a><a href="/2017/11/27/Android-Senior-Draw-View/" class="next">Android高级进阶笔记-View的绘制流程</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = '长桥の情书';
var disqus_identifier = '2017/11/28/Android-Senior-Animation/';
var disqus_title = 'Android高级进阶笔记-动画机制';
var disqus_url = 'http://yoursite.com/2017/11/28/Android-Senior-Animation/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/next/config.json',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//长桥の情书.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/22/Day02-breaking/">第二天</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/21/Day01-breaking/">第一天</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/14/Android-intent-bug/">Android 使用Intent传递参数时的一个bug</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/26/rx-Operate-Create-Start/">Start</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/29/Build-a-Responseive-UI-with-ConstraintLayout/">Build a Responseive UI with ConstraintLayout</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/17/html5-fkjava-char2/">疯狂HTML 5+CSS 3+JavaScript讲义笔记——2.HTML 5的常用元素与属性</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/23/rx-Operate-Create-Error/">Error</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/23/rx-Operate-Create-Empty/">Empty、Never、Throw</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/23/rx-Operate-Create-Timer/">Timer</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/23/rx-Operate-Create-Interval/">Interval</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//长桥の情书.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">长桥の情书.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>